# Ostrm Docker éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é£ç‰›OSæ•°æ®è¿ç§»](#é£ç‰›osæ•°æ®è¿ç§»)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [å¥åº·æ£€æŸ¥](#å¥åº·æ£€æŸ¥)
- [èµ„æºé™åˆ¶](#èµ„æºé™åˆ¶)
- [æ•°æ®æŒä¹…åŒ–](#æ•°æ®æŒä¹…åŒ–)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨ docker-composeï¼ˆæ¨èï¼‰

1. **å‡†å¤‡ç¯å¢ƒå˜é‡æ–‡ä»¶**
   ```bash
   cp .env.docker.example .env
   # æ ¹æ®éœ€è¦ç¼–è¾‘ .env æ–‡ä»¶
   ```

2. **å¯åŠ¨æœåŠ¡**
   ```bash
   docker-compose up -d
   ```

3. **è®¿é—®åº”ç”¨**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:3111`

4. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   docker-compose logs -f
   ```

5. **åœæ­¢æœåŠ¡**
   ```bash
   docker-compose down
   ```

### ç›´æ¥ä½¿ç”¨ Docker è¿è¡Œ

```bash
docker run -d \
  --name ostrm-app \
  -p 3111:80 \
  -v ./logs:/maindata/log \
  -v ./data/config:/maindata/config \
  -v ./data/db:/maindata/db \
  -v ./strm:/app/backend/strm \
  --restart unless-stopped \
  hienao6/ostrm:latest
```

---

## ğŸ”„ é£ç‰›OSæ•°æ®è¿ç§»

### é‡è¦ï¼šç»§æ‰¿å†å²æ•°æ®

å¦‚æœæ‚¨å·²ç»åœ¨é£ç‰›OSä¸Šéƒ¨ç½²äº†æ—§ç‰ˆæœ¬çš„ Ostrmï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿ç§»æ•°æ®ï¼š

### æ­¥éª¤ 1: åœæ­¢æ—§ç‰ˆæœ¬
```bash
# åœ¨é£ç‰›OSä¸Šåœæ­¢æ—§å®¹å™¨
docker stop <æ—§å®¹å™¨å>
docker rm <æ—§å®¹å™¨å>
```

### æ­¥éª¤ 2: ç¡®è®¤æ—§æ•°æ®ä½ç½®
æŸ¥æ‰¾æ—§ç‰ˆæœ¬çš„æ•°æ®å­˜å‚¨è·¯å¾„ï¼Œé€šå¸¸åœ¨ï¼š
- `/path/to/old/data/config/` - é…ç½®æ–‡ä»¶
- `/path/to/old/data/db/` - æ•°æ®åº“æ–‡ä»¶
- `/path/to/old/data/log/` - æ—¥å¿—æ–‡ä»¶
- `/path/to/old/strm/` - STRM æ–‡ä»¶

### æ­¥éª¤ 3: é…ç½®æ•°æ®å·æ˜ å°„
ç¼–è¾‘ `docker-compose.yml` æˆ–ä½¿ç”¨ç›´æ¥è¿è¡Œå‘½ä»¤ï¼Œå°†æ—§æ•°æ®è·¯å¾„æŒ‚è½½åˆ°æ–°å®¹å™¨ï¼š

```yaml
volumes:
  - /path/to/old/data/log:/maindata/log        # æ—¥å¿—
  - /path/to/old/data/config:/maindata/config  # é…ç½®
  - /path/to/old/data/db:/maindata/db          # æ•°æ®åº“
  - /path/to/old/strm:/app/backend/strm        # STRMæ–‡ä»¶
```

### æ­¥éª¤ 4: å¯åŠ¨æ–°ç‰ˆæœ¬
```bash
docker-compose up -d
```

### æ­¥éª¤ 5: éªŒè¯æ•°æ®
- æ£€æŸ¥ç™»å½•ä¿¡æ¯æ˜¯å¦ä¿ç•™
- ç¡®è®¤ä»»åŠ¡é…ç½®å®Œæ•´
- éªŒè¯æ•°æ®åº“è®°å½•å­˜åœ¨
- æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æ­£å¸¸å†™å…¥

---

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `LOG_PATH_HOST` | å®¿ä¸»æœºæ—¥å¿—è·¯å¾„ | `./logs` |
| `CONFIG_PATH_HOST` | å®¿ä¸»æœºé…ç½®è·¯å¾„ | `./data/config` |
| `DB_PATH_HOST` | å®¿ä¸»æœºæ•°æ®åº“è·¯å¾„ | `./data/db` |
| `STRM_PATH_HOST` | å®¿ä¸»æœºSTRMæ–‡ä»¶è·¯å¾„ | `./strm` |
| `SPRING_PROFILES_ACTIVE` | Spring Profile | `prod` |

### ç«¯å£æ˜ å°„
- å¤–éƒ¨ç«¯å£ï¼š`3111`ï¼ˆå¯åœ¨ `docker-compose.yml` ä¸­ä¿®æ”¹ï¼‰
- å†…éƒ¨ç«¯å£ï¼š`80` (Caddy), `8080` (Spring Boot)

---

## ğŸ¥ å¥åº·æ£€æŸ¥

åº”ç”¨å·²é…ç½®è‡ªåŠ¨å¥åº·æ£€æŸ¥ï¼š

- **æ£€æŸ¥ç«¯ç‚¹**: `http://localhost:8080/actuator/health`
- **æ£€æŸ¥é—´éš”**: 30ç§’
- **è¶…æ—¶æ—¶é—´**: 10ç§’
- **å¯åŠ¨å®½é™æœŸ**: 60ç§’
- **é‡è¯•æ¬¡æ•°**: 3æ¬¡

### æŸ¥çœ‹å¥åº·çŠ¶æ€
```bash
docker inspect --format='{{.State.Health.Status}}' ostrm-app
```

### å¥åº·çŠ¶æ€è¯´æ˜
- `starting`: å®¹å™¨å¯åŠ¨ä¸­
- `healthy`: æœåŠ¡æ­£å¸¸è¿è¡Œ
- `unhealthy`: æœåŠ¡å¼‚å¸¸

---

## ğŸ’» èµ„æºé™åˆ¶

### é»˜è®¤èµ„æºé…ç½®
```yaml
deploy:
  resources:
    limits:
      cpus: '2.0'      # CPU ä¸Šé™
      memory: 1G       # å†…å­˜ä¸Šé™
    reservations:
      cpus: '0.5'      # CPU é¢„ç•™
      memory: 256M     # å†…å­˜é¢„ç•™
```

### æ ¹æ®éœ€è¦è°ƒæ•´
ç¼–è¾‘ `docker-compose.yml` ä¸­çš„ `deploy.resources` éƒ¨åˆ†ã€‚

---

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–

### å·æŒ‚è½½ç»“æ„

```
å®¿ä¸»æœºç›®å½•                  å®¹å™¨å†…ç›®å½•              è¯´æ˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
./logs/              â†’   /maindata/log/          æ—¥å¿—æ–‡ä»¶
./data/config/       â†’   /maindata/config/       é…ç½®æ–‡ä»¶
./data/db/           â†’   /maindata/db/           SQLiteæ•°æ®åº“
./strm/              â†’   /app/backend/strm/      STRMè¾“å‡ºæ–‡ä»¶
```

### æ•°æ®å®Œæ•´æ€§ä¿éšœ
- æ‰€æœ‰é‡è¦æ•°æ®éƒ½å­˜å‚¨åœ¨æŒä¹…åŒ–å·ä¸­
- å®¹å™¨é‡å¯æˆ–åˆ é™¤ä¸ä¼šä¸¢å¤±æ•°æ®
- æ”¯æŒå¹³æ»‘å‡çº§å’Œç‰ˆæœ¬è¿ç§»

### å¤‡ä»½å»ºè®®
å®šæœŸå¤‡ä»½ä»¥ä¸‹ç›®å½•ï¼š
```bash
# å¤‡ä»½æ•°æ®
tar -czf ostrm-backup-$(date +%Y%m%d).tar.gz ./data ./strm
```

---

## ğŸ“Š æ—¥å¿—é…ç½®

### å®¹å™¨æ—¥å¿—
```yaml
logging:
  driver: "json-file"
  options:
    max-size: "10m"    # å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§10MB
    max-file: "3"       # æœ€å¤šä¿ç•™3ä¸ªæ—¥å¿—æ–‡ä»¶
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
docker-compose logs --tail=100
```

---

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¥åº·æ£€æŸ¥å¤±è´¥
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker logs ostrm-app

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker exec -it ostrm-app bash
```

### æ•°æ®æƒé™é—®é¢˜
```bash
# ä¿®å¤æƒé™ï¼ˆå¦‚éœ€è¦ï¼‰
chmod -R 755 ./data ./logs ./strm
```

### ç«¯å£å†²çª
ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„ï¼š
```yaml
ports:
  - "3112:80"  # æ”¹æˆå…¶ä»–ç«¯å£
```

---

## ğŸ“ æ›´æ–°è®¡åˆ’

æ‰€æœ‰ Docker ç›¸å…³çš„é…ç½®æ–‡ä»¶å·²ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ï¼š
- âœ… Dockerfile ä¼˜åŒ–å’Œå¥åº·æ£€æŸ¥
- âœ… docker-compose.yml èµ„æºé™åˆ¶å’Œå¥åº·æ£€æŸ¥
- âœ… Actuator å¥åº·æ£€æŸ¥ç«¯ç‚¹é…ç½®
- âœ… æ•°æ®æŒä¹…åŒ–å·é…ç½®å®Œå–„
- âœ… é£ç‰›OSæ•°æ®è¿ç§»æŒ‡å—

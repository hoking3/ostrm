# =================================================================
# Ostrm - Quarkus Application Configuration
# @author hienao
# @date 2025-12-31
# =================================================================

# =========================
# 应用基础配置
# =========================
quarkus.application.name=ostrm
quarkus.application.version=3.0.0

# HTTP 服务配置
quarkus.http.port=8080
quarkus.http.host=0.0.0.0

# =========================
# 路径配置
# =========================
app.paths.logs=${APP_LOG_PATH:/maindata/log}
app.paths.data=${APP_DATA_PATH:/maindata}
app.paths.database=${APP_DATABASE_PATH:/maindata/db/openlist2strm.db}
app.paths.config=${APP_CONFIG_PATH:/maindata/config}
app.paths.strm=${APP_STRM_PATH:/app/backend/strm}
app.paths.user-info=${APP_USER_INFO_PATH:/maindata/config/userInfo.json}
app.paths.frontend-logs=${APP_FRONTEND_LOGS_PATH:/maindata/log/frontend}

# =========================
# 数据库配置 - SQLite
# =========================
quarkus.datasource.db-kind=sqlite
quarkus.datasource.jdbc.url=jdbc:sqlite:${app.paths.database}
quarkus.datasource.jdbc.max-size=3
quarkus.datasource.jdbc.min-size=1
quarkus.datasource.jdbc.acquisition-timeout=30

# =========================
# MyBatis 配置
# =========================
quarkus.mybatis.environment.id=production
quarkus.mybatis.initial-sql=PRAGMA journal_mode=WAL;
quarkus.mybatis.mapper-locations=classpath:mapper/*.xml
quarkus.mybatis.type-aliases-package=com.hienao.openlist2strm.entity
quarkus.mybatis.configuration.map-underscore-to-camel-case=true
quarkus.mybatis.configuration.log-impl=org.apache.ibatis.logging.slf4j.Slf4jImpl

# =========================
# Flyway 数据库迁移
# =========================
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=classpath:db/migration
quarkus.flyway.out-of-order=true

# =========================
# JWT 安全配置
# =========================
mp.jwt.verify.publickey.location=publicKey.pem
mp.jwt.verify.issuer=ostrm
smallrye.jwt.sign.key.location=privateKey.pem
smallrye.jwt.new-token.lifespan=1209600
# Token 有效期: 14天 = 14 * 24 * 60 * 60 = 1209600 秒

jwt.secret=${JWT_SECRET:secret}
jwt.expiration-min=${JWT_EXPIRATION_MIN:20160}

# =========================
# Quarkus Security 配置
# =========================
# 公开端点（无需认证）
quarkus.http.auth.permission.public.paths=/api/sign/login,/api/sign/register,/api/sign/check,/health,/health/*,/q/*,/swagger-ui/*,/v3/api-docs/*
quarkus.http.auth.permission.public.policy=permit

# API 端点（需要认证）
quarkus.http.auth.permission.api.paths=/api/*
quarkus.http.auth.permission.api.policy=authenticated

# WebSocket 端点（需要认证）
quarkus.http.auth.permission.ws.paths=/ws/*
quarkus.http.auth.permission.ws.policy=permit

# 静态资源（无需认证）
quarkus.http.auth.permission.static.paths=/static/*,/favicon.ico
quarkus.http.auth.permission.static.policy=permit

# =========================
# CORS 配置
# =========================
quarkus.http.cors=true
quarkus.http.cors.origins=*
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=Authorization,Content-Type,Accept
quarkus.http.cors.exposed-headers=Authorization
quarkus.http.cors.access-control-max-age=24H

# =========================
# OpenAPI 配置
# =========================
quarkus.smallrye-openapi.path=/v3/api-docs
quarkus.swagger-ui.path=/swagger-ui.html
quarkus.swagger-ui.always-include=true

# =========================
# 健康检查配置
# =========================
quarkus.smallrye-health.root-path=/actuator/health
quarkus.health.extensions.enabled=true

# =========================
# 日志配置
# =========================
quarkus.log.console.enable=true
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.console.level=INFO

quarkus.log.file.enable=true
quarkus.log.file.path=${app.paths.logs}/ostrm.log
quarkus.log.file.level=INFO
quarkus.log.file.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.file.rotation.max-file-size=10M
quarkus.log.file.rotation.max-backup-index=5

# 分类日志级别
quarkus.log.category."com.hienao".level=DEBUG
quarkus.log.category."io.quarkus".level=INFO
quarkus.log.category."org.apache.ibatis".level=WARN

# =========================
# 缓存配置
# =========================
quarkus.cache.caffeine."default".expire-after-write=5M
quarkus.cache.caffeine."default".maximum-size=1000

# =========================
# GitHub 配置
# =========================
github.repo.owner=${GITHUB_REPO_OWNER:hienao}
github.repo.name=${GITHUB_REPO_NAME:ostrm}
github.api.timeout=${GITHUB_API_TIMEOUT:30}
github.api.retry-count=${GITHUB_API_RETRY_COUNT:3}

# =========================
# Native Image 配置
# =========================
quarkus.native.enabled=false
quarkus.native.container-build=true
quarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-mandrel-builder-image:jdk-21

# 反射配置
quarkus.native.additional-build-args=--initialize-at-run-time=org.sqlite.core.NativeDB
quarkus.native.resources.includes=.*\\.pem,mapper/.*\\.xml,db/migration/.*\\.sql

# =========================
# 时区配置
# =========================
quarkus.default-locale=zh-CN
user.timezone=Asia/Shanghai

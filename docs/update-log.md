# 更新历史

本文档记录了 OpenList to Stream 的所有版本更新内容，帮助用户了解新功能、改进和修复的问题。

## 当前版本

### v2.2.8 (2026-02-08)

#### ✨ 新功能
- 🎨 **Vue Select 下拉组件**: 新增 vue-select 第三方组件，提供自定义下拉选项样式，完美适配深色主题

#### 🛠️ 功能优化
- 📐 **前端架构重构**: 前端架构采用 Feature-Sliced Design 改良版，提供更清晰的代码组织结构
- 📄 **日志管理优化**: 日志页面简化优化，提供更直观的日志查看体验
- 📖 **架构文档**: 新增前端架构文档（frontend/ARCHITECTURE.md）

#### 🐛 问题修复
- 修复下拉框在深色主题下的背景和文字颜色问题
- 修复日志页面刷新时 authStore 未定义的错误
- 修复编辑 OpenList 配置和任务弹窗点击遮罩层意外关闭的问题

---

### v2.2.7 (2026-02-03)

#### 🛠️ 功能优化
- 🔧 **开发脚本优化**: 改进开发环境脚本，增强调试能力和错误处理
- 💾 **内存泄漏修复**: 修复文件流未关闭导致的内存泄漏问题
- 🔄 **文件处理优化**: 新增文件保存接口，优化文件处理流程
- ⚡ **服务优化**: 优化 OpenList API 服务、媒体刮削服务、系统配置服务和任务执行服务

---

### v2.2.6 (2025-12-30)

#### ✨ 新功能
- 📊 **系统日志管理**: 新增系统日志查看页面，支持实时日志流、日志级别过滤、关键词搜索、自动滚动及日志文件下载功能
- ⚡ **资源优化**: 深度优化 JVM 内存占用、线程池配置、缓存策略及数据库连接池，显著降低系统资源消耗（内存占用降低约 50%）

#### 🛠️ 功能优化
- 🎨 **STRM 生成优化**: 智能检测 STRM 文件内容，仅在最终 URL 发生变化时才重新生成文件，减少磁盘 I/O
- 🔄 **OpenList 配置**: 优化 OpenList 配置管理界面，修复配置内网openlist ip时的异常问题

#### 🐛 问题修复
- 修复 OpenList 字幕文件和封面图片在 302 重定向场景下无法下载的问题
- 修复 TMDB 路径占位符解析错误


### v1.2.0 (2025-11-07) 大量代码重构，镜像名调整为openlist-strm，挂载目录调整，不支持直接升级

#### ✨ 新功能
- 🔗 **URL编码控制**: 新增STRM链接URL编码开关，支持灵活配置编码行为，完美处理中文和特殊字符路径
- 🌐 **Base URL替换**: 支持STRM文件生成时的基础URL替换功能，适配内网外网不同访问场景
- 🏗️ **Web服务器升级**: 从Nginx迁移到Caddy，提供更现代的Web服务器解决方案
- 📦 **构建优化**: 优化Docker构建流程，支持Java 21运行时环境，提升性能和兼容性

#### 🛠️ 技术改进
- 🐳 **容器化优化**: 改进多阶段Docker构建，使用Ubuntu 22.04基础镜像
- 🛠️ **路径标准化**: 统一容器内路径管理，增强跨平台兼容性
- 🔧 **依赖更新**: 升级核心依赖版本，提升系统稳定性和安全性
- 📝 **文档完善**: 更新技术文档和部署指南

#### 🐛 问题修复
- 修复OpenList配置中URL编码选项无法保存的问题
- 解决特殊字符和中文路径的处理问题
- 优化容器内存占用和启动性能

#### ⚠️ 重要说明
- **架构变更**: 大量代码重构，不支持直接从旧版本升级
- **挂载目录**: 重新设计目录结构，采用标准化路径
- **迁移要求**: 需要手动迁移数据，详见迁移指南

---

### v1.1.1 (2025-09-27)

#### 🛠️ 功能优化
- 🎨 **新版本提示优化**: 有新版本时提示更新
- 🧹 **cron定时任务表达式优化**: 支持unix cron表达式，自动替换成quartz定时任务表达式

#### 🐛 问题修复
- 修复nginx 特殊配置场景下请求接口报错无法使用的问题

---

## 历史版本

### v1.1.0 (2025-09-18)

#### 🛠️ 功能优化
- 🎨 **刮削规则优化**: 刮削逻辑优化，增加匹配成功率
- 🧹 **功能提示优化**: 重命名正则表达式增加使用示例，方便理解
- 🧹 **openlist 文件下载优化**: 优化从openlist下载nfo/封面图片时，原始文件302重定向导致下载失败的问题（无测试条件，如有问题issue反馈）

### v1.0.13 (2025-09-07)

#### 🐛 问题修复
- 修复上个版本引入的新创建容器，只有登录没注册的入口的问题

### v1.0.11 (2025-09-06) 数据上报部分请关注下，如不需要请自行关闭

#### ✨ 新功能
- 🔍 **数据上报系统**: 新增匿名使用数据统计功能，帮助改进产品体验（可在设置中关闭）
- 📊 **日志管理系统**: 支持日志级别配置和保留天数设置，提供更灵活的日志管理

#### 🛠️ 功能优化
- 🎨 **设置界面改进**: 新增数据上报开关、日志级别和保留天数配置选项
- 🧹 **日志清理增强**: 日志清理任务集成应用使用统计，优化清理逻辑
- 🔒 **隐私保护**: 数据上报仅收集匿名功能使用统计，不涉及用户隐私信息

#### 🐛 问题修复
- 修复前端日志API路径认证问题
- 优化后端时间戳处理逻辑
- 修复Docker环境变量配置问题

#### ⚠️ 兼容性说明
- 日志级别变更需要重启应用后生效
- 数据上报功能默认开启，可在设置中关闭

### v1.0.10 (2025-09-03)

#### ✨ 问题修复
- 修复openlist下已存在刮削NFO及图片文件时，strm目录下对应文件异常问题（建议全量刮削一次）

### v1.0.9 (2025-08-26)

#### ✨ 新功能
- 优化AI刮削逻辑，处理AI识别文件名匹配不到TMDB数据的问题（建议在设置中重置下提示词并报错）
- 日志调整

### v1.0.8 (2025-08-16)

#### ✨ 新功能
- 优化刮削逻辑，添加正则匹配，减少AI token消耗
- 添加刮削设置，优先获取openlist中已存在的刮削信息和字幕信息
- UI改版

### v1.0.7 (2025-08-04)

#### ✨ 新功能
- 手动执行时支持增量全量执行
- AI识别文件刮削优化
- 优化容器内存占用
- TMDB API 支持设置代理访问

### v1.0.1 (2025-07-30)

🎉 **项目首次发布**

#### ✨ 新功能
- 🎬 **STRM 文件生成**: 支持将 OpenList 文件列表转换为 STRM 流媒体文件
- 📋 **任务管理系统**: 完整的任务创建、编辑、删除功能
- ⏰ **定时任务调度**: 基于 Cron 表达式的自动化执行
- 🔄 **双模式更新**: 支持增量更新和全量更新两种模式
- 🔐 **用户认证**: 基于 JWT 的安全认证机制
- 🌐 **Web 界面**: 基于 Nuxt.js 3 + Vue 3 的现代化前端界面
- 🐳 **容器化部署**: 完整的 Docker 和 Docker Compose 支持

#### 🛠️ 技术栈
- **前端**: Nuxt.js 3, Vue 3, Tailwind CSS
- **后端**: Spring Boot 3, MyBatis, Quartz Scheduler
- **数据库**: SQLite
- **部署**: Docker, Nginx

#### 📦 部署方式
- Docker 单容器部署
- Docker Compose 编排部署
- 源码构建部署

---

## 版本规划

### 即将推出的功能

#### v1.2.0 (计划中)
- 🎯 **智能路径匹配**: 更智能的文件路径匹配算法
- 📱 **移动端适配**: 响应式设计优化，支持移动设备访问
- 🔄 **批量操作**: 支持批量任务操作和配置
- 📊 **数据看板**: 更丰富的数据统计和可视化界面

#### v1.3.0 (计划中)
- 🔌 **插件系统**: 支持第三方插件扩展功能
- 🌐 **多语言支持**: 国际化支持，支持英语、日语等多种语言
- 📋 **模板管理**: 任务模板功能，快速创建相似任务
- 🔔 **通知增强**: 支持钉钉、企业微信等多种通知方式

#### v1.4.0 (计划中)
- 🏗️ **集群部署**: 支持多节点集群部署
- ⚡ **性能优化**: 大幅提升处理速度和并发能力
- 🔍 **高级搜索**: 支持更复杂的文件搜索和过滤条件
- 📈 **监控告警**: 完善的系统监控和告警机制

---

## 更新说明

### 版本号规则
采用 [语义化版本](https://semver.org/lang/zh-CN/) 规范：
- **主版本号**：不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 发布周期
- **主版本**：根据重大功能更新发布，不定期
- **次版本**：每月发布一次，包含新功能改进
- **修订版本**：根据问题修复需要，随时发布

### 更新渠道
- **稳定版**：推荐生产环境使用，经过充分测试
- **测试版**：包含最新功能，适合早期体验
- **开发版**：最新代码，可能存在不稳定因素

---

## 升级指南

### 从旧版本升级

#### 1. 备份数据
升级前务必备份重要数据：
```bash
# 备份配置和数据库
tar -czf backup-$(date +%Y%m%d).tar.gz ./data/

# 备份 STRM 文件
tar -czf strm-backup-$(date +%Y%m%d).tar.gz ./strm/
```

#### 2. 停止应用
```bash
# Docker Compose 部署
docker-compose down

# Docker 直接部署
docker stop openlist-strm
```

#### 3. 拉取新版本
```bash
# 拉取最新镜像
docker pull hienao6/openlist-strm:latest

# 或指定版本
docker pull hienao6/openlist-strm:v1.1.1
```

#### 4. 重新启动
```bash
# Docker Compose 部署
docker-compose up -d

# Docker 直接部署
docker run -d \
  --name openlist-strm \
  -p 3111:80 \
  -v ./data/config:/maindata/config \
  -v ./data/db:/maindata/db \
  -v ./logs:/maindata/log \
  -v ./strm:/app/backend/strm \
  --restart always \
  hienao6/openlist-strm:latest
```

#### 5. 验证升级
1. 访问应用确认正常运行
2. 检查任务配置是否完整
3. 测试一个任务执行
4. 查看日志确认无错误

### 配置迁移
某些版本升级可能需要配置迁移：

#### v1.2.0 重大升级迁移指南

⚠️ **重要提示**: v1.2.0 是重大架构更新，**不支持直接升级**，需要手动迁移数据。

**迁移步骤**:

1. **停止旧版本容器**
```bash
docker-compose down
```

2. **备份现有数据**
```bash
# 创建备份目录
mkdir -p ./backup/v1-backup

# 备份数据库文件
cp -r ./data/config/db ./backup/v1-backup/

# 备份配置文件
cp -r ./data/config/*.json ./backup/v1-backup/

# 备份日志文件
cp -r ./data/log ./backup/v1-backup/

# 备份STRM文件
cp -r ./strm ./backup/v1-backup/
```

3. **清理旧容器和镜像**
```bash
docker-compose down --rmi all --volumes --remove-orphans
```

4. **创建新的目录结构**
```bash
# 创建标准化的数据目录
mkdir -p ./data/config ./data/db ./logs ./strm
```

5. **迁移数据到新结构**
```bash
# 迁移数据库文件 (从 /app/data/config/db 到 /maindata/db)
cp ./backup/v1-backup/db/* ./data/db/

# 迁移配置文件 (从 /app/data/config 到 /maindata/config)
cp ./backup/v1-backup/*.json ./data/config/

# 迁移日志文件 (从 /app/data/log 到 /maindata/log)
cp ./backup/v1-backup/log/* ./logs/

# STRM文件路径不变
# ./strm → /app/backend/strm (保持一致)
```

6. **更新环境配置**
```bash
# 复制新的环境配置模板
cp .env.docker.example .env

# 根据需要编辑配置
# 默认配置已经适配新的目录结构
```

7. **启动新版本**
```bash
# 使用新的镜像名称构建并启动
docker-compose build
docker-compose up -d
```

8. **验证迁移**
- 访问 `http://localhost:3111` 确认应用正常
- 检查任务配置是否完整迁移
- 测试一个任务执行
- 查看日志确认无错误

**主要变更**:
- ✅ 镜像名: `hienao6/openlist-strm:latest`
- ✅ 数据库路径: `/maindata/db` (之前: `/app/data/config/db`)
- ✅ 配置路径: `/maindata/config` (之前: `/app/data/config`)
- ✅ 日志路径: `/maindata/log` (之前: `/app/data/log`)
- ✅ STRM路径: `/app/backend/strm` (保持不变)

**迁移注意事项**:
- 🔄 **手动迁移**: 必须手动复制数据文件
- 📁 **路径变更**: 容器内路径结构完全重新设计
- 🔧 **配置更新**: 使用新的环境变量配置方式
- ✅ **数据兼容**: 数据库格式和配置文件格式保持兼容

#### v1.0.x → v1.1.x
- ✅ 无需手动迁移，配置自动兼容
- 🎨 建议查看新的系统设置选项
- 🔒 建议检查数据上报设置

---

## 问题反馈

### 报告问题
如果在使用过程中遇到问题：

1. **检查版本**: 确认使用的是最新版本
2. **查看日志**: 收集相关的错误日志
3. **搜索问题**: 查看 [GitHub Issues](https://github.com/hienao/openlist-strm/issues) 是否已有相关问题
4. **创建问题**: 提交新的 Issue，包含详细信息和复现步骤

### 功能建议
欢迎提出功能建议和改进意见：

1. **讨论想法**: 在 Discussions 中讨论新功能想法
2. **提交建议**: 在 Issues 中提交功能建议
3. **参与开发**: 欢迎提交 Pull Request

### 获取帮助
- 📖 **文档**: 查看完整的 [项目文档](https://github.com/hienao/openlist-strm/blob/main/README.md)
- 💬 **社区**: 在 GitHub Discussions 中交流
- 🐛 **问题**: 通过 GitHub Issues 报告问题
- 📧 **联系**: 通过项目主页的联系方式

---

感谢您使用 OpenList to Stream！您的反馈和建议是我们持续改进的动力。